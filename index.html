<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø²ÙŠØªÙƒ | ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ù…ÙˆØ²Ù‘Ø¹</title>

<style>
body{font-family:Tahoma,Arial;background:#f2f2f2;padding:15px}
.container{background:#fff;padding:20px;border-radius:10px;max-width:700px;margin:auto}
h2{text-align:center}
select,button{width:100%;padding:12px;margin-top:10px;font-size:16px}
button{border:none;cursor:pointer}
.product{background:#f9f9f9;padding:12px;margin-top:10px;border-radius:6px}
.price{color:#0a7cff;font-weight:bold}
.qty{display:flex;gap:10px;align-items:center;margin-top:8px}
.qty button{width:40px;background:#ddd}
.cart{background:#eef6ff;padding:12px;margin-top:15px;border-radius:6px}
.whatsapp{background:#25D366;color:#fff;margin-top:10px}
.footer{text-align:center;font-size:13px;color:#666;margin-top:20px}
</style>
</head>

<body>

<div class="container">
  <h2>ğŸ“¦ ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ù…ÙˆØ²Ù‘Ø¹</h2>

  <select id="categorySelect">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>
  </select>

  <div id="products"></div>

  <div class="cart" id="cartBox" style="display:none">
    <strong>ğŸ§¾ Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</strong>
    <div id="cartItems"></div>
    <div class="price" id="totalPrice"></div>
    <button class="whatsapp" onclick="sendOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨</button>
  </div>

  <div class="footer">Ø²ÙŠØªÙƒ â€“ Distributor Order Tool</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", ()=>{

const WHATSAPP="201019388501";
let data=null;
let cart={};

/* ===== LOAD DATA ===== */
fetch("oil_shop_complete.json")
.then(r=>r.json())
.then(j=>{
  data=j;
  loadCategories();
});

/* ===== LOAD CATEGORIES ===== */
function loadCategories(){
  const s=document.getElementById("categorySelect");
  data.categories.forEach(c=>{
    const o=document.createElement("option");
    o.value=c.id;o.textContent=c.name;
    s.appendChild(o);
  });
}

/* ===== CATEGORY CHANGE ===== */
document.getElementById("categorySelect").onchange=function(){
  const id=Number(this.value);
  const box=document.getElementById("products");
  box.innerHTML="";
  if(!id) return;

  data.products.filter(p=>p.category_id===id).forEach(p=>{
    box.innerHTML+=`
      <div class="product">
        <strong>${p.product_name}</strong><br>
        ${p.liters?`Ø§Ù„Ø³Ø¹Ø©: ${p.liters} ${p.unit}<br>`:""}
        <div class="price">Ø§Ù„Ø³Ø¹Ø±: ${p.wholesale_price} Ø¬Ù†ÙŠÙ‡</div>

        <div class="qty">
          <button onclick="updateQty(${p.id}, -1)">âˆ’</button>
          <span id="q_${p.id}">0</span>
          <button onclick="updateQty(${p.id}, 1)">+</button>
        </div>
      </div>
    `;
  });
};

/* ===== UPDATE QTY ===== */
window.updateQty=function(id,delta){
  const product=data.products.find(p=>p.id===id);
  if(!product) return;

  if(!cart[id]) cart[id]={...product, qty:0};
  cart[id].qty+=delta;
  if(cart[id].qty<=0) delete cart[id];

  document.getElementById("q_"+id).innerText=cart[id]?cart[id].qty:0;
  renderCart();
};

/* ===== RENDER CART ===== */
function renderCart(){
  const box=document.getElementById("cartBox");
  const items=document.getElementById("cartItems");
  const totalBox=document.getElementById("totalPrice");

  items.innerHTML="";
  let total=0;

  Object.values(cart).forEach(p=>{
    const line=p.qty*p.wholesale_price;
    total+=line;
    items.innerHTML+=`
      <div>
        ${p.product_name} Ã— ${p.qty}
        = ${line} Ø¬Ù†ÙŠÙ‡
      </div>
    `;
  });

  if(total>0){
    box.style.display="block";
    totalBox.innerText="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+total+" Ø¬Ù†ÙŠÙ‡";
  }else{
    box.style.display="none";
  }
}

/* ===== SEND ORDER ===== */
window.sendOrder=function(){
  let msg="Ø·Ù„Ø¨ Ù…ÙˆØ²Ù‘Ø¹ â€“ Ø²ÙŠØªÙƒ\n------------------\n";
  let total=0;

  Object.values(cart).forEach(p=>{
    const line=p.qty*p.wholesale_price;
    total+=line;
    msg+=`${p.product_name} Ã— ${p.qty} = ${line} Ø¬Ù†ÙŠÙ‡\n`;
  });

  msg+=`\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬Ù†ÙŠÙ‡`;

  window.open(
    `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`,
    "_blank"
  );
};

});
</script>

</body>
</html>
