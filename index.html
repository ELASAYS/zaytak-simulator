<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø²ÙŠØªÙƒ | ÙƒØªØ§Ù„ÙˆØ¬ Ø°ÙƒÙŠ + Upsell</title>

<style>
body{font-family:Tahoma,Arial;background:#f2f2f2;padding:20px}
.container{background:#fff;padding:20px;border-radius:10px;max-width:540px;margin:auto}
h2{text-align:center}
select{width:100%;padding:12px;margin-top:10px;font-size:16px}
.product{background:#f9f9f9;padding:12px;margin-top:10px;border-radius:6px}
.price{color:#0a7cff;font-weight:bold;margin-top:5px}
.whatsapp{margin-top:8px;background:#25D366;color:#fff;border:none;padding:10px;width:100%;cursor:pointer}
.upsell{background:#eef6ff;border:1px dashed #9cc1ff}
.footer{margin-top:20px;text-align:center;font-size:13px;color:#666}
</style>
</head>

<body>

<div class="container">
  <h2>ğŸ”§ Ø²ÙŠØªÙƒ â€“ ÙƒØªØ§Ù„ÙˆØ¬ Ø°ÙƒÙŠ</h2>

  <!-- Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
  <select id="carBrand">
    <option value="">Ø§Ø®ØªØ± Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</option>
    <option>Toyota</option><option>Mitsubishi</option><option>Hyundai</option>
    <option>Nissan</option><option>Chevrolet</option><option>Kia</option>
    <option>Peugeot</option><option>Renault</option>
  </select>

  <select id="engineType">
    <option value="">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø±Ùƒ</option>
    <option value="Ø¨Ù†Ø²ÙŠÙ†">Ø¨Ù†Ø²ÙŠÙ†</option>
    <option value="Ø¯ÙŠØ²Ù„">Ø¯ÙŠØ²Ù„</option>
  </select>

  <!-- Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª -->
  <select id="categorySelect" onchange="loadProducts()">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>
  </select>

  <div id="productsList"></div>

  <div class="footer">Ø²ÙŠØªÙƒ â€“ Smart Oil Catalog</div>
</div>

<script>
/* ================= SETTINGS ================= */
const PROFIT_RATE = 1.25;
const WHATSAPP_NUMBER = "201019388501";

/* ================= DATA ================= */
let shopData=null;

fetch("oil_shop_complete.json")
  .then(r=>r.json())
  .then(d=>{shopData=d;loadCategories();})
  .catch(()=>alert("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"));

/* ================= LOAD CATEGORIES ================= */
function loadCategories(){
  const s=document.getElementById("categorySelect");
  shopData.categories.forEach(c=>{
    const o=document.createElement("option");
    o.value=c.id;o.textContent=c.name;s.appendChild(o);
  });
}

/* ================= LOAD PRODUCTS + UPSELL ================= */
function loadProducts(){
  const catId=Number(document.getElementById("categorySelect").value);
  const box=document.getElementById("productsList");
  box.innerHTML="";
  if(!catId) return;

  const car=document.getElementById("carBrand").value||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
  const engine=document.getElementById("engineType").value||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";

  let products=shopData.products.filter(p=>p.category_id===catId);
  if(products.length===0){box.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>";return;}

  products.forEach(p=>{
    const sell=Math.round(p.wholesale_price*PROFIT_RATE);
    box.innerHTML+=`
      <div class="product">
        <strong>${p.product_name}</strong><br>
        ${p.liters?`Ø§Ù„Ø³Ø¹Ø©: ${p.liters} ${p.unit}<br>`:""}
        <div class="price">Ø§Ù„Ø³Ø¹Ø±: ${sell} Ø¬Ù†ÙŠÙ‡</div>
        <button class="whatsapp"
          onclick="sendWA(['${p.product_name}'], [${sell}])">
          Ø§Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
        </button>
      </div>
    `;
  });

  /* Upsell ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø²ÙŠÙˆØª Ù…Ø­Ø±ÙƒØ§Øª (category_id === 1) */
  if(catId===1){
    const filter = shopData.products.find(p=>p.category_name==="ÙÙ„Ø§ØªØ±");
    const grease = shopData.products.find(p=>p.category_name==="Ø´Ø­ÙˆÙ…");

    let upsellNames=[], upsellPrices=[];
    if(filter){
      const s=Math.round(filter.wholesale_price*PROFIT_RATE);
      upsellNames.push(filter.product_name);
      upsellPrices.push(s);
      box.innerHTML+=`
        <div class="product upsell">
          <strong>ğŸ§° ÙÙ„ØªØ± Ù…ÙÙ‚ØªØ±Ø­</strong><br>
          ${filter.product_name}<br>
          <div class="price">Ø§Ù„Ø³Ø¹Ø±: ${s} Ø¬Ù†ÙŠÙ‡</div>
        </div>`;
    }
    if(grease){
      const s=Math.round(grease.wholesale_price*PROFIT_RATE);
      upsellNames.push(grease.product_name);
      upsellPrices.push(s);
      box.innerHTML+=`
        <div class="product upsell">
          <strong>ğŸ§´ Ø´Ø­Ù… Ù…ÙÙ‚ØªØ±Ø­</strong><br>
          ${grease.product_name}<br>
          <div class="price">Ø§Ù„Ø³Ø¹Ø±: ${s} Ø¬Ù†ÙŠÙ‡</div>
        </div>`;
    }

    if(upsellNames.length){
      box.innerHTML+=`
        <button class="whatsapp"
          onclick="sendWA(${JSON.stringify(upsellNames)}, ${JSON.stringify(upsellPrices)})">
          Ø§Ø·Ù„Ø¨ Ø§Ù„Ø²ÙŠØª + Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª
        </button>`;
    }
  }
}

/* ================= WHATSAPP ================= */
function sendWA(names, prices){
  const car=document.getElementById("carBrand").value||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
  const engine=document.getElementById("engineType").value||"ØºÙŠØ± Ù…Ø­Ø¯Ø¯";

  let lines=names.map((n,i)=>`- ${n} (${prices[i]} Ø¬Ù†ÙŠÙ‡)`).join("\n");
  const msg=`Ø·Ù„Ø¨ Ù…Ù† Ø²ÙŠØªÙƒ:
Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${car}
Ø§Ù„Ù…Ø­Ø±Ùƒ: ${engine}

Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:
${lines}`;
  window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`,"_blank");
}
</script>

</body>
</html>
