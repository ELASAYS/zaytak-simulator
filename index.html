<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø²ÙŠØªÙƒ | Ù…Ø³ØªØ´Ø§Ø± Ø²ÙŠØª Ø§Ù„Ø³ÙŠØ§Ø±Ø©</title>

<style>
body{font-family:Tahoma,Arial;background:#f2f2f2;padding:20px}
.container{background:#fff;padding:20px;border-radius:10px;max-width:600px;margin:auto}
h2{text-align:center}
p{text-align:center;color:#555}
select,button{width:100%;padding:12px;margin-top:10px;font-size:16px}
button{border:none;cursor:pointer}
.primary{background:#0a7cff;color:#fff}
.secondary{background:#444;color:#fff}
.whatsapp{background:#25D366;color:#fff}
.product{background:#f9f9f9;padding:12px;margin-top:10px;border-radius:6px}
.price{color:#0a7cff;font-weight:bold;margin-top:5px}
.footer{text-align:center;font-size:13px;color:#666;margin-top:20px}
</style>
</head>

<body>

<!-- ================= INTRO SCREEN ================= -->
<div class="container" id="intro">
  <h2>ğŸ”§ Ù…Ø­ØªØ§Ø± ÙÙŠ Ø²ÙŠØª Ø¹Ø±Ø¨ÙŠØªÙƒØŸ</h2>
  <p>Ø¬Ø§ÙˆØ¨ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„ÙŠÙ†ØŒ ÙˆÙ†Ù‚ÙˆÙ„Ùƒ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¢Ù…Ù† Ø¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯</p>

  <button class="primary" onclick="startIndividual()">
    Ø§Ø¹Ø±Ù Ø§Ù„Ø²ÙŠØª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
  </button>

  <button class="secondary" onclick="startPro()">
    Ø£Ù†Ø§ ÙˆØ±Ø´Ø© / Ù…ÙˆØ²Ù‘Ø¹
  </button>
</div>

<!-- ================= MAIN APP ================= -->
<div class="container" id="mainApp" style="display:none">

<h2>ğŸ”§ Ø²ÙŠØªÙƒ â€“ Ø§Ø®ØªØ§Ø± Ø§Ù„ØµØ­</h2>

<!-- Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
<select id="clientType">
  <option value="individual">ÙØ±Ø¯</option>
  <option value="workshop">ÙˆØ±Ø´Ø©</option>
  <option value="distributor">Ù…ÙˆØ²Ù‘Ø¹</option>
</select>

<!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
<select id="carBrand">
  <option value="">Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</option>
  <option>Toyota</option><option>Mitsubishi</option><option>Hyundai</option>
  <option>Nissan</option><option>Chevrolet</option><option>Kia</option>
  <option>Peugeot</option><option>Renault</option>
</select>

<select id="engineType">
  <option value="">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø±Ùƒ</option>
  <option value="Ø¨Ù†Ø²ÙŠÙ†">Ø¨Ù†Ø²ÙŠÙ†</option>
  <option value="Ø¯ÙŠØ²Ù„">Ø¯ÙŠØ²Ù„</option>
</select>

<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø±Ø§Ø± -->
<button class="primary" onclick="recommendOil()">Ø§Ø¹Ø±Ù Ø§Ù„Ø²ÙŠØª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨</button>
<button class="secondary" onclick="compareOils()">Ù‚Ø§Ø±Ù† Ø§Ù„Ø²ÙŠÙˆØª</button>

<!-- Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬ -->
<select id="categorySelect" onchange="loadCategory()">
  <option value="">ØªØµÙØ­ Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ</option>
</select>

<div id="result"></div>

<div class="footer">Ø²ÙŠØªÙƒ â€“ Smart Oil System</div>
</div>

<script>
/* ================== MODE ================== */
let MODE = "individual";

/* ================== SETTINGS ================== */
const WHATSAPP = "201019388501";

/* ================== PRICING ================== */
function priceRate(){
  const t=document.getElementById("clientType").value;
  if(t==="distributor") return 1.05;
  if(t==="workshop") return 1.15;
  return 1.25;
}

/* ================== DATA ================== */
let data=null;
fetch("oil_shop_complete.json")
.then(r=>r.json())
.then(d=>{data=d;loadCategories();});

/* ================== START MODES ================== */
function startIndividual(){
  document.getElementById("intro").style.display="none";
  document.getElementById("mainApp").style.display="block";
  MODE="individual";
}

function startPro(){
  document.getElementById("intro").style.display="none";
  document.getElementById("mainApp").style.display="block";
  unlockProMode();
}

/* ================== PRO MODE ================== */
function unlockProMode(){
  MODE="professional";
  document.getElementById("categorySelect").style.display="block";
}

/* ================== CATEGORIES ================== */
function loadCategories(){
  const s=document.getElementById("categorySelect");
  data.categories.forEach(c=>{
    const o=document.createElement("option");
    o.value=c.id;o.textContent=c.name;
    s.appendChild(o);
  });
  document.getElementById("categorySelect").style.display="none";
}

/* ================== RECOMMEND ================== */
function recommendOil(){
  const box=document.getElementById("result");
  box.innerHTML="";

  const engine=document.getElementById("engineType").value||"Ø¨Ù†Ø²ÙŠÙ†";

  const oils=data.products.filter(p =>
    p.category_id===1 &&
    (engine==="Ø¯ÙŠØ²Ù„"
      ? p.product_name.includes("15")||p.product_name.includes("20")
      : p.product_name.includes("10")||p.product_name.includes("5"))
  );

  if(oils.length===0){
    box.innerHTML="Ø£ÙŠ Ø²ÙŠØª Ù…ÙˆØ«ÙˆÙ‚ Ù…Ù†Ø§Ø³Ø¨ Ù„Ø¹Ø±Ø¨ÙŠØªÙƒØŒ Ø§Ø·Ù„Ø¨ ÙˆØ³Ù†Ø³Ø§Ø¹Ø¯Ùƒ.";
    return;
  }

  oils.sort((a,b)=>a.wholesale_price-b.wholesale_price);
  const chosen=oils[0];
  const price=Math.round(chosen.wholesale_price*priceRate());

  box.innerHTML=`
    <div class="product">
      <strong>Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¢Ù…Ù† Ù„Ø¹Ø±Ø¨ÙŠØªÙƒ</strong><br>
      ${chosen.product_name}<br><br>
      <div class="price">Ø§Ù„Ø³Ø¹Ø±: ${price} Ø¬Ù†ÙŠÙ‡</div>
      <p style="font-size:14px;color:#555">
        Ø§Ù„Ø²ÙŠØª Ø¯Ù‡ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø±Ùƒ ÙˆÙ…Ø´ Ù‡ÙŠØ¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØªÙˆØ±.
      </p>
      <button class="whatsapp"
        onclick="wa('${chosen.product_name}',${price})">
        Ø§Ø·Ù„Ø¨Ù‡ÙˆÙ„ÙŠ
      </button>
    </div>`;
}

/* ================== COMPARE ================== */
function compareOils(){
  unlockProMode();
  const box=document.getElementById("result");
  box.innerHTML="";

  const oils=data.products.filter(p=>p.category_id===1).slice(0,5);
  oils.forEach(p=>{
    const price=Math.round(p.wholesale_price*priceRate());
    box.innerHTML+=card(p,price);
  });
}

/* ================== CATEGORY VIEW ================== */
function loadCategory(){
  unlockProMode();
  const id=Number(document.getElementById("categorySelect").value);
  const box=document.getElementById("result");
  box.innerHTML="";
  if(!id) return;

  data.products.filter(p=>p.category_id===id)
    .forEach(p=>{
      const price=Math.round(p.wholesale_price*priceRate());
      box.innerHTML+=card(p,price);
    });
}

/* ================== CARD ================== */
function card(p,price){
  return `
  <div class="product">
    <strong>${p.product_name}</strong><br>
    ${p.liters?`Ø§Ù„Ø³Ø¹Ø©: ${p.liters} ${p.unit}<br>`:""}
    <div class="price">Ø§Ù„Ø³Ø¹Ø±: ${price} Ø¬Ù†ÙŠÙ‡</div>
    <button class="whatsapp"
      onclick="wa('${p.product_name}',${price})">
      Ø§Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨
    </button>
  </div>`;
}

/* ================== WHATSAPP ================== */
function wa(name,price){
  const msg=`Ø·Ù„Ø¨ Ù…Ù† Ø²ÙŠØªÙƒ:
${name}
Ø§Ù„Ø³Ø¹Ø±: ${price} Ø¬Ù†ÙŠÙ‡`;
  window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`);
}
</script>

</body>
</html>
