<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø²ÙŠØªÙƒ | Ù…Ù†ØµØ© Ø¨ÙŠØ¹ Ø²ÙŠÙˆØª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</title>

<style>
body{font-family:Tahoma,Arial;background:#f2f2f2;padding:15px}
.container{background:#fff;padding:20px;border-radius:10px;max-width:620px;margin:auto}
h2{text-align:center}
p{text-align:center;color:#555}
select,button{width:100%;padding:12px;margin-top:10px;font-size:16px}
button{border:none;cursor:pointer}
.primary{background:#0a7cff;color:#fff}
.secondary{background:#444;color:#fff}
.whatsapp{background:#25D366;color:#fff}
.product{background:#f9f9f9;padding:12px;margin-top:10px;border-radius:6px}
.price{color:#0a7cff;font-weight:bold;margin-top:5px}
.footer{text-align:center;font-size:13px;color:#666;margin-top:20px}
.hidden{display:none}
</style>
</head>

<body>

<!-- ============ INTRO ============ -->
<div class="container" id="intro">
  <h2>ğŸ”§ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø²ÙŠØªÙƒ</h2>
  <p>Ø§Ø®ØªØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„ÙŠÙƒ</p>

  <button class="primary" id="btnIndividual">ğŸš— Ø£Ù†Ø§ ØµØ§Ø­Ø¨ Ø¹Ø±Ø¨ÙŠØ©</button>
  <button class="secondary" id="btnPro">ğŸª ÙˆØ±Ø´Ø© / Ù…ÙˆØ²Ù‘Ø¹</button>
</div>

<!-- ============ MAIN APP ============ -->
<div class="container hidden" id="mainApp">

<h2 id="title">ğŸ”§ Ø²ÙŠØªÙƒ â€“ Ø§Ø®ØªØ§Ø± Ø§Ù„ØµØ­</h2>

<select id="clientType">
  <option value="individual">ÙØ±Ø¯</option>
  <option value="workshop">ÙˆØ±Ø´Ø©</option>
  <option value="distributor">Ù…ÙˆØ²Ù‘Ø¹</option>
</select>

<select id="carBrand">
  <option value="">Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</option>
  <option>Toyota</option><option>Mitsubishi</option><option>Hyundai</option>
  <option>Nissan</option><option>Chevrolet</option><option>Kia</option>
  <option>Peugeot</option><option>Renault</option>
</select>

<select id="engineType">
  <option value="">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø±Ùƒ</option>
  <option value="Ø¨Ù†Ø²ÙŠÙ†">Ø¨Ù†Ø²ÙŠÙ†</option>
  <option value="Ø¯ÙŠØ²Ù„">Ø¯ÙŠØ²Ù„</option>
</select>

<button class="primary" id="btnRecommend">Ø§Ø¹Ø±Ù Ø§Ù„Ø²ÙŠØª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨</button>
<button class="secondary" id="btnCompare">Ù‚Ø§Ø±Ù† Ø§Ù„Ø²ÙŠÙˆØª</button>

<select id="categorySelect" class="hidden">
  <option value="">ØªØµÙØ­ Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ</option>
</select>

<div id="result"></div>
<div class="footer">Ø²ÙŠØªÙƒ â€“ Smart Oil Sales System</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){

const WHATSAPP="201019388501";
let data=null;

/* ===== DATA LOAD ===== */
fetch("oil_shop_complete.json")
.then(r=>r.json())
.then(d=>{
  data=d;
  loadCategories();
});

/* ===== START BUTTONS ===== */
document.getElementById("btnIndividual").onclick = ()=>{
  showMain("individual");
};

document.getElementById("btnPro").onclick = ()=>{
  showMain("workshop");
};

/* ===== SHOW MAIN ===== */
function showMain(mode){
  document.getElementById("intro").classList.add("hidden");
  document.getElementById("mainApp").classList.remove("hidden");
  document.getElementById("clientType").value = mode;
  handleClientType();
}

/* ===== CLIENT TYPE CHANGE ===== */
document.getElementById("clientType").onchange = handleClientType;

function handleClientType(){
  const type = document.getElementById("clientType").value;
  const car = document.getElementById("carBrand");
  const engine = document.getElementById("engineType");
  const cat = document.getElementById("categorySelect");

  if(type==="distributor"){
    car.classList.add("hidden");
    engine.classList.add("hidden");
    cat.classList.remove("hidden");
    document.getElementById("title").innerText="ğŸ“¦ ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ù…ÙˆØ²Ù‘Ø¹";
  }else{
    car.classList.remove("hidden");
    engine.classList.remove("hidden");
    document.getElementById("title").innerText="ğŸ”§ Ø²ÙŠØªÙƒ â€“ Ø§Ø®ØªØ§Ø± Ø§Ù„ØµØ­";
  }
}

/* ===== CATEGORIES ===== */
function loadCategories(){
  const s=document.getElementById("categorySelect");
  data.categories.forEach(c=>{
    const o=document.createElement("option");
    o.value=c.id;o.textContent=c.name;
    s.appendChild(o);
  });
}

/* ===== BUTTON ACTIONS ===== */
document.getElementById("btnRecommend").onclick = recommendOil;
document.getElementById("btnCompare").onclick = compareOils;
document.getElementById("categorySelect").onchange = loadCategory;

/* ===== PRICING ===== */
function priceRate(){
  const t=document.getElementById("clientType").value;
  if(t==="distributor") return 1.05;
  if(t==="workshop") return 1.15;
  return 1.25;
}

/* ===== RECOMMEND ===== */
function recommendOil(){
  const box=document.getElementById("result");
  box.innerHTML="";
  const engine=document.getElementById("engineType").value||"Ø¨Ù†Ø²ÙŠÙ†";

  const oils=data.products.filter(p=>p.category_id===1);
  if(!oils.length){box.innerText="Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª";return;}

  oils.sort((a,b)=>a.wholesale_price-b.wholesale_price);
  const p=oils[0];
  const price=Math.round(p.wholesale_price*priceRate());

  box.innerHTML=`
    <div class="product">
      <strong>Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¢Ù…Ù†</strong><br>${p.product_name}
      <div class="price">${price} Ø¬Ù†ÙŠÙ‡</div>
      <button class="whatsapp" onclick="wa('${p.product_name}',${price})">
        Ø§Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨
      </button>
    </div>`;
}

/* ===== COMPARE ===== */
function compareOils(){
  const box=document.getElementById("result");
  box.innerHTML="";
  data.products.filter(p=>p.category_id===1).slice(0,5)
    .forEach(p=>{
      const price=Math.round(p.wholesale_price*priceRate());
      box.innerHTML+=`
        <div class="product">
          <strong>${p.product_name}</strong>
          <div class="price">${price} Ø¬Ù†ÙŠÙ‡</div>
          <button class="whatsapp" onclick="wa('${p.product_name}',${price})">
            Ø§Ø·Ù„Ø¨
          </button>
        </div>`;
    });
}

/* ===== CATEGORY ===== */
function loadCategory(){
  const id=Number(this.value);
  const box=document.getElementById("result");
  box.innerHTML="";
  data.products.filter(p=>p.category_id===id)
    .forEach(p=>{
      const price=Math.round(p.wholesale_price*priceRate());
      box.innerHTML+=`
        <div class="product">
          <strong>${p.product_name}</strong>
          <div class="price">${price} Ø¬Ù†ÙŠÙ‡</div>
          <button class="whatsapp" onclick="wa('${p.product_name}',${price})">
            Ø§Ø·Ù„Ø¨
          </button>
        </div>`;
    });
}

/* ===== WHATSAPP ===== */
window.wa=function(name,price){
  window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(
    `Ø·Ù„Ø¨ Ø²ÙŠØª:\n${name}\nØ§Ù„Ø³Ø¹Ø±: ${price} Ø¬Ù†ÙŠÙ‡`
  )}`);
};

});
</script>

</body>
</html>
